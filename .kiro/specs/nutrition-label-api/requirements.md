# 요구사항 문서

## 개요

이 기능은 기존 Python 영양성분표 분석 시스템을 FastAPI 기반 웹 서비스로 변환합니다. 시스템은 Spring 서버로부터 요청을 받아 Google Cloud Vision API와 Gemini AI를 사용하여 식품 이미지를 분석하고, 구조화된 영양 정보를 JSON 형식으로 반환합니다. API는 이미지가 영양성분표나 원재료명을 포함하는지 검증하고, 단일 및 이중 이미지 시나리오를 처리하며, 포괄적인 오류 처리를 제공합니다.

## 요구사항

### 요구사항 1

**사용자 스토리:** Spring 서버 애플리케이션으로서, Python FastAPI 서비스에 이미지 URL 분석 요청을 보내어 식품 이미지로부터 구조화된 영양 정보를 얻고 싶습니다.

#### 수락 기준

1. API 엔드포인트에 POST 요청이 전송될 때 시스템은 JSON 형식으로 이미지 URL을 수락해야 합니다
2. 요청에 1개 또는 2개의 이미지 URL이 포함될 때 시스템은 이에 따라 처리해야 합니다
3. 요청에 2개 초과 또는 0개의 이미지 URL이 포함될 때 시스템은 검증 오류를 반환해야 합니다
4. 2개의 이미지 URL이 제공될 때 시스템은 하나는 원재료 정보, 다른 하나는 영양 정보를 포함한다고 가정해야 합니다
5. 처리가 완료될 때 시스템은 영양 데이터와 상태 정보가 포함된 JSON 응답을 반환해야 합니다

### 요구사항 2

**사용자 스토리:** API 서비스로서, 제공된 이미지 URL의 이미지가 영양성분표나 원재료 정보를 포함하는지 검증하여 관련 없는 이미지를 초기에 거부하고 싶습니다.

#### 수락 기준

1. 이미지 URL이 제공될 때 시스템은 URL에서 이미지를 다운로드해야 합니다
2. 이미지가 다운로드될 때 시스템은 Google Cloud Vision API를 사용하여 텍스트를 추출해야 합니다
3. 텍스트가 추출될 때 시스템은 Gemini AI를 사용하여 영양 또는 원재료 정보 포함 여부를 검증해야 합니다
4. 텍스트에 관련 정보가 포함되지 않은 경우 시스템은 적절한 메시지와 함께 실패 상태를 반환해야 합니다
5. 검증이 통과될 때 시스템은 상세 분석을 진행해야 합니다

### 요구사항 3

**사용자 스토리:** API 서비스로서, 제공된 두 이미지 URL의 이미지가 동일한 식품에 속하는지 확인하여 정확한 통합 분석을 제공하고 싶습니다.

#### 수락 기준

1. 두 이미지 URL이 제공될 때 시스템은 각 URL에서 이미지를 다운로드해야 합니다
2. 이미지들이 다운로드될 때 시스템은 Google Cloud Vision API를 사용하여 두 이미지에서 텍스트를 추출해야 합니다
3. 두 텍스트가 추출될 때 시스템은 Gemini AI를 사용하여 동일한 제품에 속하는지 검증해야 합니다
4. 이미지들이 서로 다른 제품으로 판단될 경우 시스템은 실패 상태를 반환해야 합니다
5. 검증이 통과될 때 시스템은 텍스트들을 결합하여 분석해야 합니다

### 요구사항 4

**사용자 스토리:** API 서비스로서, 검증된 이미지 텍스트에서 구조화된 영양 정보를 추출하여 클라이언트에게 일관된 JSON 데이터를 반환하고 싶습니다.

#### 수락 기준

1. 이미지 검증이 통과될 때 시스템은 추출된 텍스트를 Gemini AI에 전송하여 분석해야 합니다
2. 텍스트를 분석할 때 시스템은 제품명, 영양 정보, 원재료를 추출해야 합니다
3. 제품명을 추출할 때 시스템은 공백을 제거하고 한글/영문/숫자만 유지해야 합니다
4. 영양 수치를 추출할 때 시스템은 단위를 제거하고 숫자 문자열만 반환해야 합니다
5. 영양 정보가 누락된 경우 시스템은 null 값을 사용해야 합니다
6. 분석이 완료될 때 시스템은 decodeStatus 필드가 포함된 적절히 형식화된 JSON을 반환해야 합니다
7. 영양정보와 관련 없는 이미지인 경우 decodeStatus는 "cancelled"이어야 합니다
8. 관련있는 이미지이지만 사진이 흐리거나 영양정보 일부가 잘려 정확한 정보를 얻을 수 없는 경우 decodeStatus는 "failed"이어야 합니다
9. 성공적으로 분석된 경우 decodeStatus는 "completed"이어야 합니다

### 요구사항 5

**사용자 스토리:** API를 유지보수하는 개발자로서, 포괄적인 오류 처리와 로깅을 원하여 문제를 해결하고 시스템 성능을 모니터링하고 싶습니다.

#### 수락 기준

1. Google Cloud Vision API 오류가 발생할 때 시스템은 오류를 로그하고 적절한 HTTP 상태를 반환해야 합니다
2. Gemini AI 오류가 발생할 때 시스템은 오류를 로그하고 적절한 HTTP 상태를 반환해야 합니다
3. 파일 처리 오류가 발생할 때 시스템은 이를 우아하게 처리해야 합니다
4. 처리 단계가 완료될 때 시스템은 진행 정보를 로그해야 합니다
5. 오류가 발생할 때 시스템은 명확한 메시지와 함께 구조화된 오류 응답을 반환해야 합니다

### 요구사항 6

**사용자 스토리:** 시스템 관리자로서, API가 적절히 구성되고 문서화되어 쉽게 배포하고 유지보수할 수 있기를 원합니다.

#### 수락 기준

1. API가 시작될 때 시스템은 환경 설정에서 Google Cloud 자격 증명을 로드해야 합니다
2. API가 시작될 때 시스템은 환경 설정에서 Gemini API 키를 로드해야 합니다
3. 설정이 누락된 경우 시스템은 명확한 오류 메시지를 제공해야 합니다
4. API가 실행 중일 때 표준 엔드포인트에서 OpenAPI 문서를 제공해야 합니다
5. 요청이 이루어질 때 시스템은 적절한 HTTP 상태 코드와 응답 헤더를 포함해야 합니다